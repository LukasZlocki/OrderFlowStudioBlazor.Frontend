@page "/gateleader"
@using OrderFlowStudio.Frontend.Data;
@inject HttpClient http;

<h1>Registering order at area</h1>

<!-- Add form -->
<div class="container">
    <div class="row align-items-center">
        <div class="col-md-auto">
            <label>Order number:</label> <br>
            <label>Quantity:</label> <br>
            <label>Part number:</label> <br>
        </div>
        <div class="col-sm">
            <input class="form-control" type="text" placeholder="Quantity:" aria-label="Search" @bind="_orderNb">
            <input class="form-control" type="text" placeholder="Quantity:" aria-label="Search" @bind="_quantity">
            <select class="form-control selectpicker" asp-items @bind="_product.PartNumber">
                <option>--select--</option>
                @foreach (var item in productsList)
                {
                    <option value="@item.PartNumber">@item.PartNumber</option>
                }
            </select>  
        </div>
    </div>
</div>

<button class = "btn btn-dark" @onclick="CreateOrder">Create order</button>

@code {
    int _orderNb;
    int _quantity;
    Product _product = new Product();

    public List<Product> productsList = new List<Product>(); 

    private async Task CreateOrder()
    {
        var orderOnCreateDto = new OrderOnCreateDto
        {
            OrderNumber = _orderNb,
            Quantity = _quantity,
            ProductNumber = _product.PartNumber
        };
        var response = await http.PostJsonAsync<Order>("http://localhost:6001/api/addorder", orderOnCreateDto);
    }

    // load data with list of product numbers to put it in picking list
    protected override async Task OnInitializedAsync()
    {
        productsList = await http.GetJsonAsync<List<Product>>("http://localhost:6001/api/product");
    }
}